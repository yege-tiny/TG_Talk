# Telegram 多机器人托管平台

> 一键部署，轻松管理多个 Telegram 客服机器人

## 🚀 快速部署

### 方式 1：Docker 部署（⭐ 推荐）

**三步快速开始：**

```bash
# 1. 下载配置文件
mkdir tg_multi_bot && cd tg_multi_bot
curl -O https://raw.githubusercontent.com/ryty1/TG_Talk/main/docker-compose.yml

# 2. 编辑配置（修改 MANAGER_TOKEN 和 ADMIN_CHANNEL）
nano docker-compose.yml

# 3. 启动服务
docker-compose up -d
```

**优势：**
- ✅ 跨平台支持（Linux/Windows/macOS）
- ✅ 环境隔离，无依赖冲突
- ✅ 一键更新，轻松维护
- ✅ 3分钟完成部署

📖 [查看详细 Docker 部署文档](./README_DOCKER.md) | 📄 [快速入门指南](./QUICKSTART_DOCKER.md)

---

### 方式 2：传统部署（仅 Linux）

```bash
# 一键安装/卸载（安装后默认开启自启后台运行）
bash <(curl -Ls https://raw.githubusercontent.com/ryty1/TG_Talk/refs/heads/main/setup.sh)
```

**适用场景：** Linux 服务器环境，需要直接控制系统服务

---

> **项目运营中心**
> 如不想自己部署，可直接使用本项目快捷服务 [双向托管机器人](https://t.me/tg_multis_bot)
  
## 📖 简介

这是一个完整的 Telegram 机器人托管解决方案，允许用户通过一个管理机器人来创建和管理多个客服机器人。支持直接消息转发和话题群组两种模式，内置验证码系统防止滥用。

## ✨ 核心特性

- 🤖 **多机器人管理** - 一个平台管理无数个客服机器人
- 💬 **双模式支持** - 直接转发模式 / 话题群组模式
- 🔐 **智能验证** - 5种验证码类型，有效防止垃圾消息
- 📣 **自定义欢迎语** - SQLite 数据库存储，支持自动备份   （新增）
- 📊 **用户管理** - 查看、拉黑、解除拉黑用户
- 💾 **数据持久化** - SQLite 数据库存储，支持自动备份
- 🔄 **自动同步** - GitHub 自动备份，数据安全无忧
- 👥 **管理员功能** - 用户清单、广播通知、清理失效Bot

## 📦 部署方式对比

| 特性 | Docker 部署 ⭐ | 传统部署 |
|------|----------------|---------|
| 支持系统 | Linux/Windows/macOS | 仅 Linux |
| 部署时间 | ~3 分钟 | ~5 分钟 |
| 环境隔离 | ✅ 完全隔离 | ❌ 依赖系统 |
| 维护难度 | ⭐ 简单 | ⭐⭐ 中等 |
| 更新方式 | `docker-compose pull && up -d` | 手动更新代码 |
| 推荐场景 | 所有用户 | Linux 服务器专家 |

**Docker 部署** 只需修改两个配置项（Bot Token 和频道 ID），无需关心 Python 版本、依赖安装等问题。

**传统部署** 脚本会自动完成：检查/安装 Python 3.11+、安装依赖包、创建虚拟环境、配置 systemd 服务、设置 GitHub 自动备份（可选）。

## 📱 使用指南

### 用户操作流程

#### 1️⃣ 添加机器人

1. 向管理机器人发送 `/start`
2. 点击 `➕ 添加机器人`
3. 输入你的 Bot Token
4. 选择工作模式：
   - **直接转发** - 消息直接转发给你
   - **话题群组** - 消息转发到群组的特定话题

#### 2️⃣ 管理机器人

点击 `🤖 我的机器人` 查看和管理：
- 📊 查看机器人状态
- 👥 查看已验证用户
- 🗑️ 删除机器人
- ⚙️ 修改配置

#### 3️⃣ 用户管理

在机器人详情页面可以：
- ✅ 查看用户列表
- 🚫 拉黑用户
- ✅ 解除拉黑
- ❌ 取消验证

### 两种工作模式

#### 模式 1：直接转发（推荐新手）

```
用户 → Bot → 你的私聊
你的私聊 → Bot → 用户
```

**优点**：简单直接，无需配置群组  
**适合**：个人客服、小型业务

#### 模式 2：话题群组（推荐专业用户）

```
用户 → Bot → 群组话题
群组话题 → Bot → 用户
```

**优点**：多人协作，消息分类管理  
**适合**：团队客服、大型业务

**配置步骤**：
1. 创建一个群组并开启话题功能
2. 将 Bot 添加为管理员
3. 在管理机器人中设置话题群组ID

### 用户管理指令

在与客服机器人的对话中，你可以使用以下指令（**仅 Bot 拥有者可用**）：

| 指令 | 功能 | 使用方式1：回复消息 | 使用方式2：直接输入 | 话题模式：直接输入 |
|------|------|-------------------|-------------------|-------------------|
| `/id` | 查看用户信息 | 回复用户消息后输入 `/id` | `/id 123456789` |   `/id`  |
| `/b` 或 `/block` | 拉黑用户 | 回复用户消息后输入 `/b` | `/b 123456789` |   `/b`  |
| `/ub` 或 `/unblock` | 解除拉黑 | 回复用户消息后输入 `/ub` | `/ub 123456789` |   `/ub`  |
| `/bl` 或 `/blocklist` | 查看黑名单 | - | `/bl` 或 `/blocklist` |   `/bl`  |
| `/uv` 或 `/unverify` | 取消验证 | 回复用户消息后输入 `/uv` | `/uv 123456789` |   `/uv`  |

### 指令使用示例

**场景1：拉黑骚扰用户**
```
用户: 发送垃圾消息
你: [回复该消息] /b
Bot: 🚫 已将用户 123456789 加入黑名单
```

**场景2：查看用户信息**
```
你: [回复用户消息] /id
Bot: 用户信息
     • 用户ID: 123456789
     • 用户名: @example
     • 姓名: Example User
     • 是否验证: ✅ 已验证
```

**场景3：批量管理**
```
你: /bl
Bot: 📋 黑名单列表：
     1. @user1 (ID: 111111)
     2. @user2 (ID: 222222)

你: /ub 111111
Bot: ✅ 已将用户 111111 从黑名单移除
```

## 👑 管理员功能

管理员（ADMIN_CHANNEL 配置的用户）拥有以下特权：

| 功能 | 图标 | 说明 | 操作方式 |
|------|------|------|---------|
| 用户清单 | 👥 | 查看所有托管机器人的用户列表 | 支持分页浏览（每页15个） |
| 广播通知 | 📢 | 向所有托管用户群发重要通知 | 平台维护、功能更新、紧急通告 |
| 清理失效Bot | 🗑️ | 检测并批量删除 Token 失效的机器人 | 保持系统健康，需二次确认 |

## 🔒 验证系统

为防止滥用，用户首次使用需要通过验证，支持5种验证码类型：

| 类型 | 图标 | 说明 | 示例 |
|------|------|------|------|
| 数学运算 | 🔢 | 加减乘混合运算 | `12 + 5 × 3 = ?` |
| 数字序列 | 📊 | 等差/等比/平方数列 | `2, 4, 8, 16, ?` |
| 中文问答 | 🇨🇳 | 常识问题 | `中国的首都是？` |
| 逻辑判断 | 🧩 | 简单推理 | `如果A>B且B>C，则？` |
| 时间问答 | ⏰ | 基础时间常识 | `一周有几天？` |

✅ 验证通过后永久有效，无需重复验证。

## 🛠️ 常用命令

### Docker 部署命令

| 功能 | 命令 |
|------|------|
| 启动服务 | `docker-compose up -d` |
| 停止服务 | `docker-compose down` |
| 重启服务 | `docker-compose restart` |
| 查看日志 | `docker-compose logs -f` |
| 查看状态 | `docker-compose ps` |
| 更新镜像 | `docker-compose pull && docker-compose up -d` |

### 传统部署命令（systemd）

| 功能 | 命令 |
|------|------|
| 启动服务 | `systemctl start tg_multi_bot` |
| 停止服务 | `systemctl stop tg_multi_bot` |
| 重启服务 | `systemctl restart tg_multi_bot` |
| 查看状态 | `systemctl status tg_multi_bot` |
| 查看日志 | `journalctl -u tg_multi_bot -f` |
| 关闭自启 | `systemctl disable tg_multi_bot` |

## 📂 文件结构

### Docker 部署

```
tg_multi_bot/
├── docker-compose.yml   # Docker Compose 配置
└── data/                # 数据目录（自动创建）
    └── bot_data.db      # SQLite 数据库
```

### 传统部署

```
/opt/tg_multi_bot/
├── host_bot.py          # 主程序
├── database.py          # 数据库模块
├── bot_data.db          # SQLite 数据库
├── .env                 # 环境配置
├── backup.sh            # 备份脚本
├── venv/                # Python 虚拟环境
└── backup_temp/         # 备份临时目录
```

### Q: Token 无效？

1. 检查 Token 是否正确复制（包含完整的字符串）
2. 确认 Bot 未被删除或禁用
3. 在 @BotFather 中重新生成 Token

### Q: 消息无法转发？

1. **直接模式**：确保你已经给 Bot 发送过 `/start`
2. **话题模式**：确认 Bot 是群组管理员且话题ID正确

## 📊 系统要求

### Docker 部署（推荐）

| 项目 | 要求 |
|------|------|
| 操作系统 | Linux/Windows/macOS |
| Docker | 20.10+ |
| Docker Compose | 1.29+ |
| 内存 | 最低 512MB（推荐 1GB+） |
| 磁盘 | 最低 1GB 可用空间 |
| 网络 | 稳定的互联网连接 |

### 传统部署

| 项目 | 要求 |
|------|------|
| 操作系统 | Ubuntu 20.04+ / Debian 10+ |
| Python | 3.11 或更高版本 |
| 内存 | 最低 512MB（推荐 1GB+） |
| 磁盘 | 最低 1GB 可用空间 |
| 网络 | 稳定的互联网连接 |


### 获取帮助

- 📖 查看完整文档（本README）
- [开发者](https://t.me/SerokBot_bot)

### 报告问题

发现 Bug 或有建议？欢迎反馈：
1. 提供详细的错误信息
2. 附上日志输出
3. 说明复现步骤

## ⚠️ 注意事项

1. **保护 Token**：切勿将 Bot Token 分享给他人
2. **定期备份**：虽然有自动备份，建议定期手动备份
3. **谨慎删除**：删除机器人前请确认，删除后无法恢复用户数据
4. **合理使用**：遵守 Telegram 的使用条款和限制
5. **监控日志**：定期查看日志，及时发现异常

## 📜 开源协议

MIT License - 自由使用，保留版权声明

## 🎯 版本信息

- **当前版本**: v2.0
- **更新日期**: 2025-11-18
- **数据库版本**: SQLite 3
- **Python版本**: 3.11+

---

**Made with ❤️ for Telegram Bot Lovers**
